<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        text-align: center;
        background: #f5f5f5;
      }
      .amount-display {
        font-size: 20px;
        font-weight: 700;
        margin: 18px 0;
        color: #222;
      }
      .payment-card {
        background: white;
        border-radius: 12px;
        padding: 12px;
        margin: 10px auto;
        width: 86%;
        max-width: 360px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        display: flex;
        align-items: center;
        text-decoration: none;
        color: #333;
      }
      .app-logo {
        width: 48px;
        height: 48px;
        margin-right: 12px;
        object-fit: contain;
      }
      .app-name {
        font-size: 16px;
        font-weight: 600;
      }
      #overlay {
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      #overlay .card {
        background: #fff;
        padding: 18px;
        border-radius: 12px;
        width: 90%;
        max-width: 420px;
        text-align: left;
      }
      #overlay .actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        padding: 10px 12px;
        border-radius: 8px;
        border: 0;
        cursor: pointer;
      }
      .btn-primary {
        background: #25d366;
        color: #fff;
      }
      .btn-muted {
        background: #f0f0f0;
        color: #222;
      }
      .note {
        font-size: 13px;
        color: #444;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <h2>Complete Your Payment</h2>
    <div class="amount-display" id="amount">Loading...</div>

    <a id="paytm-link" class="payment-card paytm-card">
      <img
        src="https://www.logo.wine/a/logo/Paytm/Paytm-Logo.wine.svg"
        class="app-logo"
        alt="Paytm"
      />
      <span class="app-name">Pay with Paytm</span>
    </a>

    <a id="phonepe-link" class="payment-card phonepe-card">
      <img
        src="data:image/png;base64,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"
        class="app-logo"
        alt="PhonePe"
      />
      <span class="app-name">Pay with PhonePe</span>
    </a>

    <a id="gpay-link" class="payment-card gpay-card">
      <img
        src="https://cdn1.iconfinder.com/data/icons/logos-brands-in-colors/436/Google_Pay_GPay_Logo-1024.png"
        class="app-logo"
        alt="Google Pay"
      />
      <span class="app-name">Pay with Google Pay</span>
    </a>

    <div style="margin-top: 14px">
      <button id="i-paid-btn" class="btn btn-primary">
        I Paid — Notify via WhatsApp
      </button>
      <button id="close-overlay" class="btn btn-muted" style="margin-left: 8px">
        Close
      </button>
    </div>

    <script>
      (function () {
        const WA_NUMBER = "918959285336";
        const params = new URLSearchParams(window.location.search);
        let amount =
          params.get("amount") ||
          sessionStorage.getItem("lastOrderAmount") ||
          "0.00";
        let amount_cents =
          params.get("amount_cents") ||
          sessionStorage.getItem("lastOrderAmountCents") ||
          "0";
        let orderId =
          params.get("orderId") ||
          sessionStorage.getItem("lastOrderId") ||
          null;

        // If orderId is missing (some checkout flows redirect without it),
        // generate a 9-digit numeric id, persist to sessionStorage and
        // update the browser URL (replaceState) so the id is visible.
        if (!orderId) {
          orderId = String(Math.floor(100000000 + Math.random() * 900000000));
          try {
            sessionStorage.setItem("lastOrderId", orderId);
            // preserve existing params and add orderId
            const u = new URL(window.location.href);
            u.searchParams.set("orderId", orderId);
            // update history without reloading
            history.replaceState(null, "", u.href);
          } catch (e) {}
        }
        if (!amount) amount = "0.00";

        document.getElementById("amount").innerHTML =
          `Order #${orderId}<br>Amount: Rs ${amount}`;

        const upiIds = {
          paytm: "vykanand@ptaxis",
          phonepe: "7669077099-2@ybl",
          gpay: "nishagautamnishu@okhdfcbank",
        };
        const merchantName = "TandoorBaaz";

        // Paytm UPI Intent - using Paytm-specific scheme to avoid redirecting to other apps
        const paytmUri = `paytmmp://pay?pa=${encodeURIComponent(upiIds.paytm)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;
        const paytmUpiUri = `upi://pay?pa=${encodeURIComponent(upiIds.paytm)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;

        // PhonePe UPI Intent with phonepe:// scheme fallback
        const phonepeUri = `phonepe://pay?pa=${encodeURIComponent(upiIds.phonepe)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;
        const phonepeUpiUri = `upi://pay?pa=${encodeURIComponent(upiIds.phonepe)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;

        // Google Pay UPI Intent - using tez:// and gpay:// schemes
        const gpayUri = `tez://upi/pay?pa=${encodeURIComponent(upiIds.gpay)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;
        const gpayAltUri = `gpay://upi/pay?pa=${encodeURIComponent(upiIds.gpay)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;
        const gpayUpiUri = `upi://pay?pa=${encodeURIComponent(upiIds.gpay)}&pn=${encodeURIComponent(merchantName)}&am=${encodeURIComponent(amount)}&cu=INR&tr=${encodeURIComponent(orderId)}`;

        function showOverlay() {
          if (document.getElementById("overlay")) return;
          const ov = document.createElement("div");
          ov.id = "overlay";
          ov.innerHTML = `<div class="card"><div style="font-size:18px;font-weight:700">Payment Instructions</div>
            <div class="note">After completing the transfer, please press <strong>"I Paid — Notify via WhatsApp"</strong> and attach your payment screenshot so we can confirm and dispatch your order quickly.</div>
            <div class="actions"><button id="wa-send" class="btn btn-primary">I Paid — Notify on WhatsApp</button><button id="ov-close" class="btn btn-muted">Close</button></div>
            </div>`;
          document.body.appendChild(ov);
          document
            .getElementById("ov-close")
            .addEventListener("click", function () {
              ov.remove();
            });
          document
            .getElementById("wa-send")
            .addEventListener("click", function () {
              const text = `I paid Rs ${amount} (Order #${orderId}) just now. Attaching screenshot for confirmation.`;
              const waUrl =
                `https://wa.me/${WA_NUMBER}?text=` + encodeURIComponent(text);
              window.open(waUrl, "_blank");
            });
        }

        document
          .getElementById("i-paid-btn")
          .addEventListener("click", function () {
            const text = `I paid Rs ${amount} (Order #${orderId}) just now. Attaching screenshot for confirmation.`;
            const waUrl =
              `https://wa.me/${WA_NUMBER}?text=` + encodeURIComponent(text);
            window.open(waUrl, "_blank");
          });
        document
          .getElementById("close-overlay")
          .addEventListener("click", function () {
            var el = document.getElementById("overlay");
            if (el) el.remove();
          });

        function showUpiFallback(upi) {
          if (document.getElementById("upiFallback")) return;
          const box = document.createElement("div");
          box.id = "upiFallback";
          box.style.cssText =
            "position:fixed;left:12px;right:12px;bottom:12px;background:#fff;border:1px solid #ddd;padding:12px;border-radius:8px;z-index:99999;box-shadow:0 8px 24px rgba(0,0,0,0.12);display:flex;align-items:center;gap:12px;";
          box.innerHTML = `<div style="flex:1"><strong>Can't open UPI app?</strong><div style="color:#555;margin-top:6px">Copy this UPI ID and paste it into your UPI app: <code id=upiCode style="background:#f7f7f7;padding:4px 6px;border-radius:4px">${upi}</code></div></div>`;
          const copyBtn = document.createElement("button");
          copyBtn.textContent = "Copy UPI";
          copyBtn.style.cssText =
            "background:#2da94f;color:#fff;border:0;padding:8px 10px;border-radius:6px;cursor:pointer";
          copyBtn.addEventListener("click", function () {
            navigator.clipboard &&
              navigator.clipboard.writeText(upi).then(function () {
                copyBtn.textContent = "Copied";
                setTimeout(() => (copyBtn.textContent = "Copy UPI"), 1200);
              });
          });
          const closeBtn = document.createElement("button");
          closeBtn.textContent = "Close";
          closeBtn.style.cssText =
            "background:transparent;border:1px solid #ddd;padding:8px 10px;border-radius:6px;cursor:pointer;margin-left:8px";
          closeBtn.addEventListener("click", function () {
            box.remove();
          });
          box.appendChild(copyBtn);
          box.appendChild(closeBtn);
          document.body.appendChild(box);
        }

        function openUriWithFallback(uri, upi) {
          const start = Date.now();
          try {
            window.location = uri;
          } catch (e) {}
          setTimeout(function () {
            if (document.visibilityState === "visible") {
              showUpiFallback(upi);
              showOverlay();
            }
          }, 1600);
        }

        // Paytm click handler - try Paytm-specific scheme first, then generic UPI
        document
          .getElementById("paytm-link")
          .addEventListener("click", function (e) {
            e.preventDefault();
            // Try Paytm-specific scheme first (paytmmp://)
            try {
              window.location.href = paytmUri;
              // Fallback to generic UPI after a delay if Paytm app not installed
              setTimeout(function () {
                if (document.visibilityState === "visible") {
                  try {
                    window.location.href = paytmUpiUri;
                  } catch (e) {
                    console.log("Paytm UPI fallback failed:", e);
                  }
                }
              }, 800);
            } catch (e) {
              console.log("Paytm scheme failed:", e);
            }
            // Show overlay and fallback options
            setTimeout(function () {
              if (document.visibilityState === "visible") {
                showUpiFallback(upiIds.paytm);
                showOverlay();
              }
            }, 1600);
          });

        // PhonePe click handler - try phonepe:// then upi://
        document
          .getElementById("phonepe-link")
          .addEventListener("click", function (e) {
            e.preventDefault();
            // Try PhonePe-specific scheme first
            try {
              window.location.href = phonepeUri;
              // Fallback to generic UPI after a delay
              setTimeout(function () {
                if (document.visibilityState === "visible") {
                  try {
                    window.location.href = phonepeUpiUri;
                  } catch (e) {
                    console.log("PhonePe UPI fallback failed:", e);
                  }
                }
              }, 800);
            } catch (e) {
              console.log("PhonePe scheme failed:", e);
            }
            // Show fallback UI
            setTimeout(function () {
              if (document.visibilityState === "visible") {
                showUpiFallback(upiIds.phonepe);
                showOverlay();
              }
            }, 1600);
          });

        // Google Pay click handler - try tez://, gpay://, then upi://
        document
          .getElementById("gpay-link")
          .addEventListener("click", function (e) {
            e.preventDefault();
            // Try Google Pay tez:// scheme first
            try {
              window.location.href = gpayUri;
              // Try gpay:// scheme as secondary fallback
              setTimeout(function () {
                if (document.visibilityState === "visible") {
                  try {
                    window.location.href = gpayAltUri;
                    // Finally try generic UPI
                    setTimeout(function () {
                      if (document.visibilityState === "visible") {
                        try {
                          window.location.href = gpayUpiUri;
                        } catch (e) {
                          console.log("GPay UPI fallback failed:", e);
                        }
                      }
                    }, 600);
                  } catch (e) {
                    console.log("GPay alt scheme failed:", e);
                  }
                }
              }, 800);
            } catch (e) {
              console.log("GPay tez scheme failed:", e);
            }
            // Show fallback UI
            setTimeout(function () {
              if (document.visibilityState === "visible") {
                showUpiFallback(upiIds.gpay);
                showOverlay();
              }
            }, 1600);
          });

        if (!params.get("orderId") && sessionStorage.getItem("lastOrderId")) {
          setTimeout(function () {
            var hint = document.createElement("div");
            hint.style.cssText =
              "position:fixed;left:12px;top:12px;background:#fff;padding:8px;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:9998";
            hint.textContent = "Order info restored from session.";
            document.body.appendChild(hint);
            setTimeout(() => hint.remove(), 2400);
          }, 400);
        }
      })();
    </script>
  </body>
</html>
